
#include <drivers/lan9252.h>

LAN9252::LAN9252(
		Port::SPIComm 	&spi,
		Port::CS 		&cs,
		Port::EXIT 		&spiIrq,
		Port::EXIT 		&sync0,
		Port::EXIT 		&sync1,
		Port::TIM		&tim
		)
: spi_(spi),
  cs_(cs),
  spiIrq_(spiIrq),
  sync0_(sync0),
  sync1_(sync1),
  tim_(tim)
{


}

LAN9252::~LAN9252()
{

}

void LAN9252::Write(uint16_t address, uint32_t val)
{


}

uint32_t LAN9252::Read(uint32_t address)
{
	spiTxData_[0] = ESC_CMD_FAST_READ;
	spiTxData_[1] = ((address >> 8) & 0xFF);
	spiTxData_[2] = (address & 0xFF);
	spiTxData_[3] = ESC_CMD_FAST_READ_DUMMY;

	cs_.Select();
	HAL_StatusTypeDef status = spi_.TransmitReceive(spiTxData_, spiRxData_, 4, 100);
	cs_.Release();

	regVal_ = (spiRxData_[3] << 24) |  (spiRxData_[2] << 16) | (spiRxData_[1] << 8) | spiRxData_[0];

	return regVal_;
}

